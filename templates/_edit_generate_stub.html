<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-generate stub from title
    const titleInput = document.getElementById('title');
    const stubInput = document.getElementById('stub');
    
    if (titleInput && stubInput) {
        // Function to unaccent Hungarian characters
        function unaccent(text) {
            const accentMap = {
                'á': 'a', 'é': 'e', 'í': 'i', 'ó': 'o', 'ö': 'o',
                'ő': 'o', 'ú': 'u', 'ü': 'u', 'ű': 'u',
                'Á': 'A', 'É': 'E', 'Í': 'I', 'Ó': 'O', 'Ö': 'O',
                'Ő': 'O', 'Ú': 'U', 'Ü': 'U', 'Ű': 'U'
            };
            
            return text.split('').map(char => accentMap[char] || char).join('');
        }
        
        // Function to generate stub from title
        function generateStub(title) {
            if (!title) return '';
            
            // Unaccent the title
            let stub = unaccent(title);
            
            // Lowercase
            stub = stub.toLowerCase();
            
            // Replace all non-alphanumeric characters with dashes
            stub = stub.replace(/[^a-z0-9]+/g, '-');

            // Trim dashes from the beginning
            stub = stub.replace(/^-+/, '');
            
            // Trim dashes from the end
            stub = stub.replace(/-+$/, '');
            
            return stub;
        }
        
        // Auto-generate stub when title changes (only if stub hasn't been manually edited)
        titleInput.addEventListener('input', function() {
            if (stubInput.getAttribute('data-edited') !== 'true') {
                stubInput.value = generateStub(this.value);
            }
        });
        
        // Mark stub as manually edited when user types in it
        stubInput.addEventListener('input', function() {
            this.setAttribute('data-edited', 'true');
        });
        
        // Also mark as edited on focus if user starts typing
        let stubWasEmpty = !stubInput.value;
        stubInput.addEventListener('focus', function() {
            stubWasEmpty = !this.value;
        });
        
        stubInput.addEventListener('keydown', function() {
            if (stubWasEmpty && !this.value) {
                // User is about to type, mark as edited
                this.setAttribute('data-edited', 'true');
            }
        });
    }
});
</script>

